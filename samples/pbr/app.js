require(["Core/Engine","Core/EventHandler","Core/Node","Components/Camera","Components/CameraController","Components/Transformation","Passes/UpdatePass","Passes/RenderPass","Renderer/BackBufferTarget","Utils/MeshHelper","Math/Math"],function(e,a,r,o,n,t,i,s,d,l){"use strict";function m(e,a,o,n,i,s,d){var m=l.createSphere(e,{shader:a}),c=new t(e),v=new r(e);c.setPosition([o,n,i]),m.renderables[0].roughness=s,m.renderables[0].metalness=d,v.addComponent(c),v.addComponent(m),e.sceneGraph.addChild(v)}var c=new e(document.getElementById("webgl2"),{preserveDrawingBuffer:!0,antialias:!0});c.gl.enable(c.gl.DEPTH_TEST),c.gl.enable(c.gl.CULL_FACE);var v=new r(c,"Camera");v.addComponent(new o(c,{fovy:Math.degToRad(60)})),v.addComponent(new n(c,{position:[-7,4,10]})),c.sceneGraph.addChild(v);var p=new s(c);p.setRenderTarget(new d(c)),p.setCamera(v.getComponent("Camera")),c.passes.push(new i(c)),c.passes.push(p);var g=c.resourceManager.createShader({vs:["precision highp float;","","uniform mat4 uWorldView;","uniform mat4 uNormalView;","uniform mat4 uWorldViewProjection;","","attribute vec3 aPosition;","attribute vec3 aNormal;","","varying vec3 vPosition;","varying vec3 vNormal;","","void main()","{","    vPosition = (uWorldView * vec4(aPosition, 1)).xyz;","    vNormal = (uNormalView * vec4(aNormal, 0)).xyz;","    gl_Position = uWorldViewProjection * vec4(aPosition, 1);","}"],fs:["precision mediump float;","","varying vec3 vPosition;","varying vec3 vNormal;","","void main()","{","    float ndotl = dot(normalize(vNormal), normalize(-vPosition));","    gl_FragColor = vec4(vec3(ndotl), 1.0);","}"],attributes:[{semantic:"position",name:"aPosition"},{semantic:"normal",name:"aNormal"}],uniforms:[{name:"uWorldView",reference:"worldView"},{name:"uNormalView",reference:"normalView"},{name:"uWorldViewProjection",reference:"worldViewProjection"}]});c.start();for(var u=4,w=4,C=2.5,f=0;u>f;++f)for(var P=0;w>P;++P)m(c,g,(f-.5*(u-1))*C,(P-.5*(w-1))*C,0,0/(u-1),0/(w-1));var h=c.resourceManager.createTexture({target:c.gl.TEXTURE_CUBE_MAP,source:["data/desert.left.png","data/desert.right.png","data/desert.bottom.png","data/desert.top.png","data/desert.back.png","data/desert.front.png"]});c.sceneGraph.addComponent(l.createSkyMesh(c,{sky:h}))});